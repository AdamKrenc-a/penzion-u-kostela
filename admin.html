<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Penzion u Kostela | Spr√°va cen</title>
    <link rel="stylesheet" href="assets/css/styles.css" />
    <style>
      .admin-panel {
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .status.success { background: #d4edda; color: #155724; }
      .status.error { background: #f8d7da; color: #721c24; }
      .status.info { background: #d1ecf1; color: #0c5460; }
      .price-input {
        display: flex;
        gap: 10px;
        margin: 10px 0;
        align-items: center;
      }
      .price-input input {
        width: 100px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
      }
      .btn:hover { background: #0056b3; }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container nav">
        <a href="index.html" class="brand" aria-label="Homepage">
          <span class="brand-title">Penzion u Kostela</span>
          <small>Litv√≠nov</small>
        </a>
      </div>
    </header>

    <main>
      <div class="admin-panel">
        <h1>üéõÔ∏è Spr√°va cen - Google Sheets</h1>
        
        <div class="status info">
          <strong>Instrukce:</strong>
          <ol>
            <li>Vytvo≈ôte Google Sheets podle <a href="GOOGLE_SHEETS_SETUP.md" target="_blank">instrukc√≠</a></li>
            <li>Zkop√≠rujte URL z publikovan√©ho listu "API"</li>
            <li>Vlo≈æte URL do pole n√≠≈æe</li>
            <li>Kliknƒõte "Testovat p≈ôipojen√≠"</li>
          </ol>
        </div>

        <div class="price-input">
          <label>Google Sheets URL:</label>
          <input type="text" id="sheetsUrl" placeholder="https://docs.google.com/spreadsheets/d/..." style="width: 400px;">
          <button class="btn" onclick="testConnection()">Testovat p≈ôipojen√≠</button>
        </div>

        <div id="status"></div>

        <div id="currentPrices" style="display: none;">
          <h3>Aktu√°ln√≠ ceny z Google Sheets:</h3>
          <div class="price-input">
            <label>1 osoba (1 noc):</label>
            <input type="number" id="single1" readonly>
            <span>Kƒç/noc</span>
          </div>
          <div class="price-input">
            <label>1 osoba (2+ noc√≠):</label>
            <input type="number" id="single2" readonly>
            <span>Kƒç/noc</span>
          </div>
          <div class="price-input">
            <label>Dvoul≈Ø≈ækov√Ω (1 noc):</label>
            <input type="number" id="double1" readonly>
            <span>Kƒç/noc</span>
          </div>
          <div class="price-input">
            <label>Dvoul≈Ø≈ækov√Ω (2+ noc√≠):</label>
            <input type="number" id="double2" readonly>
            <span>Kƒç/noc</span>
          </div>
          <div class="price-input">
            <label>T≈ô√≠l≈Ø≈ækov√Ω (1 noc):</label>
            <input type="number" id="triple1" readonly>
            <span>Kƒç/noc</span>
          </div>
          <div class="price-input">
            <label>T≈ô√≠l≈Ø≈ækov√Ω (2+ noc√≠):</label>
            <input type="number" id="triple2" readonly>
            <span>Kƒç/noc</span>
          </div>
        </div>

        <div style="margin-top: 20px;">
          <a href="index.html" class="btn">‚Üê Zpƒõt na hlavn√≠ str√°nku</a>
        </div>
      </div>
    </main>

    <script>
      async function testConnection() {
        const url = document.getElementById('sheetsUrl').value;
        const statusDiv = document.getElementById('status');
        const pricesDiv = document.getElementById('currentPrices');
        
        if (!url) {
          statusDiv.innerHTML = '<div class="status error">Zadejte Google Sheets URL</div>';
          return;
        }

        statusDiv.innerHTML = '<div class="status info">Testuji p≈ôipojen√≠...</div>';

        try {
          const response = await fetch(url);
          if (response.ok) {
            const csv = await response.text();
            const prices = parseCSV(csv);
            
            if (Object.keys(prices).length > 0) {
              // Zobrazit ceny
              document.getElementById('single1').value = prices.single1 || 'N/A';
              document.getElementById('single2').value = prices.single2 || 'N/A';
              document.getElementById('double1').value = prices.double1 || 'N/A';
              document.getElementById('double2').value = prices.double2 || 'N/A';
              document.getElementById('triple1').value = prices.triple1 || 'N/A';
              document.getElementById('triple2').value = prices.triple2 || 'N/A';
              
              pricesDiv.style.display = 'block';
              statusDiv.innerHTML = '<div class="status success">‚úÖ P≈ôipojen√≠ √∫spƒõ≈°n√©! Ceny se naƒç√≠taj√≠ spr√°vnƒõ.</div>';
              
              // Ulo≈æit URL do localStorage pro pou≈æit√≠ na webu
              localStorage.setItem('google_sheets_url', url);
            } else {
              statusDiv.innerHTML = '<div class="status error">‚ùå CSV neobsahuje platn√© ceny. Zkontrolujte strukturu Google Sheets.</div>';
            }
          } else {
            statusDiv.innerHTML = '<div class="status error">‚ùå Chyba p≈ôi naƒç√≠t√°n√≠: ' + response.status + '</div>';
          }
        } catch (error) {
          statusDiv.innerHTML = '<div class="status error">‚ùå Chyba p≈ôipojen√≠: ' + error.message + '</div>';
        }
      }

      function parseCSV(csv) {
        const lines = csv.split('\n');
        const prices = {};
        
        lines.forEach(line => {
          const [key, value] = line.split(',');
          if (key && value && !isNaN(parseInt(value))) {
            prices[key.trim()] = parseInt(value.trim());
          }
        });
        
        return prices;
      }

      // Naƒç√≠st ulo≈æenou URL p≈ôi naƒçten√≠ str√°nky
      window.addEventListener('load', function() {
        const savedUrl = localStorage.getItem('google_sheets_url');
        if (savedUrl) {
          document.getElementById('sheetsUrl').value = savedUrl;
        }
      });
    </script>
  </body>
</html>
